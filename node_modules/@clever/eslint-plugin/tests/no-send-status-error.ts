import { TSESLint } from "@typescript-eslint/experimental-utils";

import rule from "../lib/rules/no-send-status-error";

const ruleTester = new TSESLint.RuleTester({
  parserOptions: {
    sourceType: "module",
  },
  parser: require.resolve("@typescript-eslint/parser"),
});

ruleTester.run("no-send-status-error", rule, {
  valid: [
    "res.status(200)",
    "res.status(200).json({})",
    "res.sendStatus(200)",
    "res.sendStatus(201)",
    "res?.status(200)",
    "res?.sendStatus(200)",
  ],
  invalid: [
    {
      code: "res.sendStatus(400)",
      errors: [{ messageId: "noSendStatus" }],
    },
    {
      code: "res.sendStatus(500)",
      errors: [{ messageId: "noSendStatus" }],
    },
    {
      code: "res?.sendStatus(500)",
      errors: [{ messageId: "noSendStatus" }],
    },
    {
      code: "res.status(400)",
      errors: [{ messageId: "noStatus" }],
    },
    {
      code: "res.status(500)",
      errors: [{ messageId: "noStatus" }],
    },
    {
      code: "res?.status(500)",
      errors: [{ messageId: "noStatus" }],
    },
    {
      code: "res.status(500).json({})",
      errors: [{ messageId: "noStatus" }],
    },
    {
      code: "res.json({}).status(500)",
      errors: [{ messageId: "noStatus" }],
    },
  ],
});
