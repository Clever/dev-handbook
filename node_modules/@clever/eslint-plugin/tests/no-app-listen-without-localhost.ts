import { TSESLint } from "@typescript-eslint/experimental-utils";

import rule from "../lib/rules/no-app-listen-without-localhost";

const ruleTester = new TSESLint.RuleTester({
  parserOptions: {
    sourceType: "module",
  },
  parser: require.resolve("@typescript-eslint/parser"),
});

ruleTester.run("app", rule, {
  valid: [
    "app.listen(port, myhostvar, () => console.log('Testing' + port));",
    "app.listen(port, isLocalHost? 'localhost' : '0.0.0.0', () => console.log('Testing' + port));",
  ],
  invalid: [
    {
      code: "app.listen(port, '127.0.0.1', () => console.log('Testing' + port));",
      errors: [{ messageId: "serverMustBindBroadlyInProd" }],
    },
    {
      code: "app.listen(port, '0.0.0.0', () => console.log('Testing' + port));",
      errors: [{ messageId: "serverBindsTooBroadly" }],
    },
    {
      code: "app.listen(port, () => console.log('Testing' + port));",
      errors: [{ messageId: "serverBindsTooBroadly" }],
    },
    {
      code: "app.listen(config.PORT, () => { console.log(''); });",
      errors: [{ messageId: "serverBindsTooBroadly" }],
    },
  ],
});
